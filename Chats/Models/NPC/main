import Foundation

// File path to the heartbeat file in the main app's bundle
let heartbeatFilePath = "/path/to/your/app/bundle/heartbeatfile.txt"  // Replace with the correct path

// Function to terminate the server process (replace this with your actual termination logic)
func terminateServerProcess() {
  print("Terminating the server process.")
  // Your logic to terminate the server process goes here
}

// Function to ch
eck the existence of the heartbeat file and detect if the main app is still alive
func checkHeartbeatFile() {
  // Adjust the time interval based on how frequently you want to check the heartbeat file
  let checkInterval: DispatchTimeInterval = .seconds(10)
  
  while true {
    let fileManager = FileManager.default
    if fileManager.fileExists(atPath: heartbeatFilePath) {
      // If the heartbeat file exists, the main app is running; continue checking
      print("Main app is alive.")
    } else {
      // If the heartbeat file is missing, the main app may have terminated unexpectedly
      print("Main app is not responding. Terminating the server process.")
      terminateServerProcess()
      
      // Exit the watchdog process
      exit(0)
    }
    
    // Wait for the next check interval before checking again
    Thread.sleep(forTimeInterval: checkInterval.timeInterval)
  }
}

// Start the watchdog process
print("Watchdog process started.")
checkHeartbeatFile()
